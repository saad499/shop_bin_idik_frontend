<header class="header">
  <nav class="navbar navbar-expand-lg w-100">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="assets/images/logos.jpeg" alt="Logo" class="logo" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" (click)="openDrawer()" style="cursor:pointer;">
              Ajouter <i class="bi bi-plus"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/merchant/product" routerLinkActive="active">Mes produits</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/merchant/order" routerLinkActive="active">Commandes</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/merchant/delivery" routerLinkActive="active">Livreurs</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>

<!-- Product Drawer -->
<nz-drawer
  *ngIf="visible"
  [nzBodyStyle]="{ overflow: 'auto' }"
  [nzMaskClosable]="false"
  [nzWidth]="getDrawerWidth()"
  [nzVisible]="visible"
  nzTitle="Ajouter un produit"
  [nzFooter]="footerTpl"
  (nzOnClose)="closeDrawer()">
  
  <div *nzDrawerContent>
    <form nz-form>
      <!-- Product Name and Price -->
      <div class="row">
        <div class="col-12 col-md-6 mb-3">
          <label for="name_product">Nom du produit *</label>
          <input nz-input type="text" placeholder="Nom du produit" 
                 [(ngModel)]="newProduct.nom" 
                 [ngModelOptions]="{standalone: true}" 
                 required />
        </div>
        <div class="col-12 col-md-6 mb-3">
          <label for="price">Prix (MAD) *</label>
          <input nz-input type="number" min="0" step="0.01" placeholder="0.00" 
                 [(ngModel)]="newProduct.prix" 
                 [ngModelOptions]="{standalone: true}" 
                 required />
        </div>
      </div>

      <!-- Description -->
      <div class="mb-3">
        <label for="description">Description</label>
        <textarea class="form-control" id="description" rows="3" 
                  placeholder="Description du produit"
                  [(ngModel)]="newProduct.description" 
                  [ngModelOptions]="{standalone: true}"></textarea>
      </div>

      <!-- Category and Stock -->
      <div class="row">
        <div class="col-12 col-md-4 mb-3">
          <label for="category">Catégorie *</label>
          <select
            class="form-select"
            [ngModel]="selectedValue"
            (ngModelChange)="onCategoryChange($event)"
            [ngModelOptions]="{standalone: true}"
          >
            <option value="">Sélectionner une catégorie</option>

            <option *ngFor="let cat of categories" [value]="cat.id">
                {{ cat.nom }}
            </option>
          </select>
          <small class="text-muted">Debug: {{ selectedValue }}</small>
        </div>
        
        <div class="col-auto d-flex align-items-center mb-3">
          <button type="button" class="btn btn-outline-secondary me-2" 
                  [disabled]="!selectedValue"
                  (click)="editSelectedCategory()"
                  title="Modifier la catégorie">
            <i class="bi bi-pencil"></i>
          </button>
          <button type="button" class="btn btn-outline-primary" 
                  (click)="openCategoryDrawer()"
                  title="Ajouter une catégorie">
            <i class="bi bi-plus"></i>
          </button>
        </div>

        <div class="col-12 col-md mb-3">
          <label for="stock">Stock disponible *</label>
          <input nz-input type="number" min="0" placeholder="0" 
                 [(ngModel)]="newProduct.stock" 
                 [ngModelOptions]="{standalone: true}" 
                 required />
        </div>
      </div>

      <!-- Sizes -->
      <div class="mb-3">
        <label for="sizes">Tailles disponibles</label>
        <input type="text" class="form-control" 
               placeholder="Ex: S, M, L, XL" 
               [(ngModel)]="sizesInput" 
               [ngModelOptions]="{standalone: true}">
        <small class="text-muted">Séparez les tailles par des virgules</small>
      </div>

      <!-- Images -->
      <div class="mb-3">
        <label for="productImages">Images du produit</label>
        <input type="file" id="productImages" class="form-control" 
               multiple accept="image/*" 
               (change)="onFilesSelected($event)">
        <div class="mt-2 d-flex flex-wrap gap-2" *ngIf="productImages.length">
          <div *ngFor="let file of productImages" class="position-relative">
            <img [src]="file.preview" alt="preview" 
                 class="rounded border" 
                 style="width: 100px; height: 100px; object-fit: cover;">
          </div>
        </div>
      </div>

      <!-- Color -->
      <div class="mb-3">
        <label for="productColor">Couleur du produit</label>
        <input type="color" id="productColor" class="form-control form-control-color" 
               [(ngModel)]="productColor" 
               [ngModelOptions]="{standalone: true}" 
               style="width: 60px; height: 40px;">
      </div>
    </form>
  </div>

  <ng-template #footerTpl>
    <div class="d-flex justify-content-end gap-2">
      <button nz-button (click)="closeDrawer()" [disabled]="isAddingProduct">
        Annuler
      </button>
      <button nz-button nzType="primary" 
              (click)="addProduct()" 
              [disabled]="isAddingProduct" 
              [nzLoading]="isAddingProduct">
        Ajouter
      </button>
    </div>
  </ng-template>
</nz-drawer>

<!-- Category Drawer -->
<nz-drawer 
  *ngIf="categoryDrawerVisible"
  [nzVisible]="categoryDrawerVisible"
  [nzTitle]="selectedCategory ? 'Modifier la catégorie' : 'Ajouter une catégorie'"
  [nzWidth]="400"
  (nzOnClose)="closeCategoryDrawer()">
  
  <form nz-form *nzDrawerContent>
    <div class="mb-3">
      <label for="categoryName" class="form-label">Nom *</label>
      <input id="categoryName" class="form-control" 
             [(ngModel)]="newCategory.nom" 
             [ngModelOptions]="{standalone: true}"
             required />
    </div>
    <div class="mb-3">
      <label for="categoryDescription" class="form-label">Description</label>
      <textarea id="categoryDescription" class="form-control" rows="3"
                [(ngModel)]="newCategory.description" 
                [ngModelOptions]="{standalone: true}"></textarea>
    </div>
    <button 
    nz-button 
    type="button"
    nzType="primary" 
            (click)="saveCategory($event)" 
            [disabled]="isAddingCategory || !newCategory.nom" 
            [nzLoading]="isAddingCategory">
      {{ selectedCategory ? 'Modifier' : 'Ajouter' }}
    </button>
  </form>
</nz-drawer>